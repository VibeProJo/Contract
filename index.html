<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Contrat ‚Äî Mise au point sur notre relation</title>
<link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:ital,wght@0,300;0,400;0,600;1,300;1,400&family=EB+Garamond:ital,wght@0,400;0,500;1,400&family=Cinzel:wght@400;600&display=swap" rel="stylesheet">

<style>
  :root {
    --paper: #f5f0e8;
    --ink: #1a1410;
    --ink-light: #3d3028;
    --gold: #b8972a;
    --gold-light: #d4b44a;
    --red: #8b1a1a;
    --border: #c8b89a;
    --shadow: rgba(26, 20, 16, 0.15);
  }

  * { box-sizing: border-box; margin: 0; padding: 0; }

  body {
    background: #2a1f14;
    background-image: 
      radial-gradient(ellipse at 20% 50%, #3d2d1a 0%, transparent 60%),
      radial-gradient(ellipse at 80% 20%, #1a1410 0%, transparent 60%);
    min-height: 100vh;
    display: flex;
    align-items: flex-start;
    justify-content: center;
    padding: 40px 20px;
    font-family: 'EB Garamond', serif;
  }

  .document-wrapper {
    position: relative;
    max-width: 680px;
    width: 100%;
  }

  /* Wax seal decoration */
  .seal {
    position: absolute;
    top: -28px;
    left: 50%;
    transform: translateX(-50%);
    width: 56px;
    height: 56px;
    background: radial-gradient(circle at 40% 35%, #c0392b, #7b1a1a);
    border-radius: 50%;
    box-shadow: 0 4px 20px rgba(139,26,26,0.5), inset 0 -2px 4px rgba(0,0,0,0.3);
    display: flex;
    align-items: center;
    justify-content: center;
    font-family: 'Cinzel', serif;
    color: rgba(255,255,255,0.6);
    font-size: 18px;
    z-index: 10;
    letter-spacing: -1px;
  }
  .seal::after {
    content: '';
    position: absolute;
    inset: 3px;
    border-radius: 50%;
    border: 1px solid rgba(255,255,255,0.2);
  }

  .document {
    background: var(--paper);
    background-image: 
      url("data:image/svg+xml,%3Csvg width='200' height='200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noise'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='4' stitchTiles='stitch'/%3E%3CfeColorMatrix type='saturate' values='0'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noise)' opacity='0.04'/%3E%3C/svg%3E");
    border: 1px solid var(--border);
    padding: 60px 70px 50px;
    box-shadow: 
      0 20px 60px rgba(0,0,0,0.4),
      0 0 0 8px rgba(245,240,232,0.03),
      inset 0 1px 0 rgba(255,255,255,0.5);
    position: relative;
    animation: fadeIn 0.8s ease both;
  }

  /* Corner ornaments */
  .document::before, .document::after {
    content: '‚ú¶';
    position: absolute;
    color: var(--gold);
    font-size: 10px;
    opacity: 0.5;
  }
  .document::before { top: 18px; left: 18px; }
  .document::after { top: 18px; right: 18px; }

  .corner-bl, .corner-br {
    position: absolute;
    bottom: 18px;
    color: var(--gold);
    font-size: 10px;
    opacity: 0.5;
  }
  .corner-bl { left: 18px; }
  .corner-br { right: 18px; }

  /* Decorative border lines */
  .border-top, .border-bottom {
    border: none;
    height: 2px;
    background: linear-gradient(90deg, transparent, var(--gold), var(--border), var(--gold), transparent);
    margin: 0 -20px;
    opacity: 0.6;
  }
  .border-top { margin-bottom: 28px; }
  .border-bottom { margin-top: 28px; }

  h1.title {
    font-family: 'Cinzel', serif;
    font-size: 28px;
    font-weight: 600;
    letter-spacing: 8px;
    text-align: center;
    color: var(--ink);
    margin-bottom: 6px;
  }

  .subtitle {
    font-family: 'Cormorant Garamond', serif;
    font-style: italic;
    font-size: 16px;
    text-align: center;
    color: var(--ink-light);
    letter-spacing: 1px;
    margin-bottom: 0;
  }

  .section {
    margin-bottom: 24px;
    animation: slideUp 0.6s ease both;
  }

  .section:nth-child(1) { animation-delay: 0.1s; }
  .section:nth-child(2) { animation-delay: 0.2s; }
  .section:nth-child(3) { animation-delay: 0.3s; }

  .section-label {
    font-family: 'Cinzel', serif;
    font-size: 11px;
    font-weight: 600;
    letter-spacing: 3px;
    color: var(--gold);
    text-transform: uppercase;
    margin-bottom: 8px;
    display: flex;
    align-items: center;
    gap: 8px;
  }
  .section-label::after {
    content: '';
    flex: 1;
    height: 1px;
    background: linear-gradient(90deg, var(--border), transparent);
  }

  p.body-text {
    font-size: 15px;
    line-height: 1.75;
    color: var(--ink-light);
    font-style: italic;
  }

  .name-line {
    display: flex;
    align-items: baseline;
    gap: 10px;
    flex-wrap: wrap;
    font-size: 15px;
    color: var(--ink-light);
    line-height: 1.75;
    font-style: italic;
  }

  .name-line input[type="text"] {
    background: transparent;
    border: none;
    border-bottom: 1.5px solid var(--gold);
    padding: 2px 8px;
    font-family: 'EB Garamond', serif;
    font-size: 15px;
    color: var(--ink);
    outline: none;
    min-width: 140px;
    flex: 1;
    max-width: 220px;
    text-align: center;
    transition: border-color 0.2s;
  }
  .name-line input[type="text"]:focus {
    border-bottom-color: var(--red);
  }
  .name-line input[type="text"]::placeholder {
    color: #c8b89a;
    font-style: italic;
  }

  /* Checkbox options */
  .options-grid {
    display: flex;
    flex-direction: column;
    gap: 10px;
    margin-top: 6px;
  }

  .option-item {
    display: flex;
    align-items: flex-start;
    gap: 14px;
    padding: 12px 16px;
    border: 1px solid transparent;
    border-radius: 3px;
    cursor: pointer;
    transition: all 0.25s ease;
    position: relative;
  }

  .option-item:hover {
    background: rgba(184,151,42,0.06);
    border-color: var(--border);
  }

  .option-item.selected {
    background: rgba(139,26,26,0.05);
    border-color: var(--red);
  }
  .option-item.selected .option-box {
    background: var(--red);
    border-color: var(--red);
  }
  .option-item.selected .option-box::after {
    opacity: 1;
    transform: scale(1);
  }

  .option-item input[type="radio"] {
    position: absolute;
    opacity: 0;
    pointer-events: none;
  }

  .option-box {
    width: 18px;
    height: 18px;
    border: 1.5px solid var(--border);
    flex-shrink: 0;
    margin-top: 2px;
    position: relative;
    transition: all 0.2s;
    display: flex;
    align-items: center;
    justify-content: center;
  }
  .option-box::after {
    content: '‚úì';
    color: white;
    font-size: 11px;
    opacity: 0;
    transform: scale(0.5);
    transition: all 0.2s;
  }

  .option-label {
    display: flex;
    flex-direction: column;
  }
  .option-name {
    font-family: 'Cormorant Garamond', serif;
    font-size: 17px;
    font-weight: 600;
    color: var(--ink);
    line-height: 1.2;
  }
  .option-desc {
    font-size: 13px;
    color: #7a6a5a;
    font-style: italic;
    margin-top: 2px;
  }



  /* Note / message field */
  .note-field {
    margin-top: 6px;
  }
  .note-field textarea {
    width: 100%;
    background: rgba(255,255,255,0.4);
    border: 1px solid var(--border);
    padding: 10px 14px;
    font-family: 'EB Garamond', serif;
    font-size: 14px;
    color: var(--ink);
    resize: vertical;
    min-height: 80px;
    outline: none;
    transition: border-color 0.2s;
    line-height: 1.6;
  }
  .note-field textarea:focus {
    border-color: var(--gold);
  }
  .note-field textarea::placeholder {
    color: #b8a898;
    font-style: italic;
  }

  /* Legal fine print */
  .legal {
    font-size: 12px;
    line-height: 1.7;
    color: #8a7a6a;
    font-style: italic;
    border-top: 1px solid var(--border);
    padding-top: 16px;
    margin-top: 8px;
  }

  /* Submit button */
  .submit-btn {
    display: block;
    width: 100%;
    margin-top: 28px;
    padding: 14px 30px;
    background: var(--ink);
    color: var(--paper);
    border: none;
    font-family: 'Cinzel', serif;
    font-size: 12px;
    letter-spacing: 4px;
    text-transform: uppercase;
    cursor: pointer;
    position: relative;
    overflow: hidden;
    transition: all 0.3s;
  }
  .submit-btn::before {
    content: '';
    position: absolute;
    inset: 0;
    background: linear-gradient(90deg, transparent, rgba(184,151,42,0.15), transparent);
    transform: translateX(-100%);
    transition: transform 0.5s;
  }
  .submit-btn:hover::before {
    transform: translateX(100%);
  }
  .submit-btn:hover {
    background: var(--red);
    letter-spacing: 6px;
  }
  .submit-btn:active {
    transform: scale(0.99);
  }

  /* Success overlay */
  .success-overlay {
    display: none;
    position: fixed;
    inset: 0;
    background: rgba(26,20,16,0.92);
    z-index: 100;
    align-items: center;
    justify-content: center;
    flex-direction: column;
    text-align: center;
    padding: 40px;
  }
  .success-overlay.show { display: flex; animation: fadeIn 0.4s ease; }
  .success-icon {
    font-size: 48px;
    margin-bottom: 20px;
    animation: pulse 1s ease infinite alternate;
  }
  .success-title {
    font-family: 'Cinzel', serif;
    font-size: 22px;
    letter-spacing: 4px;
    color: var(--paper);
    margin-bottom: 10px;
  }
  .success-sub {
    font-family: 'Cormorant Garamond', serif;
    font-style: italic;
    font-size: 16px;
    color: #b8a898;
    max-width: 360px;
  }
  .success-close {
    margin-top: 30px;
    padding: 10px 28px;
    background: transparent;
    border: 1px solid var(--border);
    color: var(--paper);
    font-family: 'Cinzel', serif;
    font-size: 11px;
    letter-spacing: 3px;
    cursor: pointer;
    transition: all 0.2s;
  }
  .success-close:hover { background: var(--paper); color: var(--ink); }

  /* Error message */
  .error-msg {
    display: none;
    color: var(--red);
    font-size: 13px;
    font-style: italic;
    text-align: center;
    margin-top: 10px;
  }

  @keyframes fadeIn { from { opacity: 0 } to { opacity: 1 } }
  @keyframes slideUp { from { opacity: 0; transform: translateY(12px) } to { opacity: 1; transform: none } }
  
  @keyframes spin { to { transform: rotate(360deg) } }
  @keyframes pulse { from { transform: scale(1) } to { transform: scale(1.1) } }

  /* Mobile */
  @media (max-width: 600px) {
    .document { padding: 50px 28px 40px; }
    h1.title { font-size: 20px; letter-spacing: 5px; }
  }

  /* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
     PDF / PRINT VIEW
  ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
  #print-view { display: none; }

  @media print {
    @page { size: A4; margin: 0; }

    *, *::before, *::after { -webkit-print-color-adjust: exact !important; print-color-adjust: exact !important; }

    body {
      background: #f5f0e8 !important;
      display: block !important;
      padding: 0 !important;
      margin: 0 !important;
    }

    /* Hide everything except print view */
    .document-wrapper, .success-overlay { display: none !important; }

    #print-view {
      display: block !important;
    }

    .pv-page {
      width: 210mm;
      min-height: 297mm;
      padding: 28mm 24mm 24mm;
      background: #f5f0e8 !important;
      box-sizing: border-box;
      position: relative;
      font-family: 'EB Garamond', serif;
    }

    /* Corners */
    .pv-corner { position: absolute; color: #b8972a; font-size: 9px; opacity: 0.55; }
    .pv-corner.tl { top: 16mm; left: 16mm; }
    .pv-corner.tr { top: 16mm; right: 16mm; }
    .pv-corner.bl { bottom: 16mm; left: 16mm; }
    .pv-corner.br { bottom: 16mm; right: 16mm; }

    /* Decorative HR */
    .pv-hr {
      border: none;
      height: 2px;
      background: linear-gradient(90deg, transparent, #b8972a, #c8b89a, #b8972a, transparent) !important;
      opacity: 0.65;
      margin: 0 -10mm 8mm;
    }
    .pv-hr.bottom { margin: 8mm -10mm 0; }

    /* Wax seal */
    .pv-seal {
      width: 14mm; height: 14mm;
      background: radial-gradient(circle at 40% 35%, #c0392b, #7b1a1a) !important;
      border-radius: 50%;
      margin: 0 auto 6mm;
      display: flex; align-items: center; justify-content: center;
      color: rgba(255,255,255,0.6);
      font-size: 16px;
    }

    .pv-title {
      font-family: 'Cinzel', serif;
      font-size: 22pt;
      font-weight: 600;
      letter-spacing: 7px;
      text-align: center;
      color: #1a1410 !important;
      margin-bottom: 3mm;
    }
    .pv-subtitle {
      font-family: 'Cormorant Garamond', serif;
      font-style: italic;
      font-size: 11pt;
      text-align: center;
      color: #3d3028 !important;
      letter-spacing: 1px;
      margin-bottom: 0;
    }

    .pv-section { margin-bottom: 7mm; }

    .pv-label {
      font-family: 'Cinzel', serif;
      font-size: 7.5pt;
      font-weight: 600;
      letter-spacing: 2.5px;
      color: #b8972a !important;
      text-transform: uppercase;
      margin-bottom: 2.5mm;
      display: flex;
      align-items: center;
      gap: 4mm;
    }
    .pv-label::after {
      content: '';
      flex: 1;
      height: 0.4mm;
      background: linear-gradient(90deg, #c8b89a, transparent) !important;
    }

    .pv-text {
      font-size: 10.5pt;
      line-height: 1.75;
      color: #3d3028 !important;
      font-style: italic;
    }

    /* Signed name line */
    .pv-name-line {
      font-size: 10.5pt;
      color: #3d3028 !important;
      font-style: italic;
      line-height: 1.75;
    }
    .pv-name-value {
      font-style: normal;
      color: #1a1410 !important;
      font-weight: 500;
      border-bottom: 0.4mm solid #b8972a;
      padding: 0 3mm;
      display: inline-block;
      min-width: 30mm;
      text-align: center;
    }

    /* Options list */
    .pv-options { margin-top: 2mm; }
    .pv-option {
      display: flex;
      align-items: flex-start;
      gap: 4mm;
      padding: 2.5mm 3mm;
      margin-bottom: 1.5mm;
      border: 0.3mm solid transparent;
      border-radius: 1mm;
    }
    .pv-option.chosen {
      background: rgba(139,26,26,0.04) !important;
      border-color: #8b1a1a !important;
    }
    .pv-checkbox {
      width: 4mm; height: 4mm;
      border: 0.4mm solid #c8b89a;
      flex-shrink: 0;
      margin-top: 0.8mm;
      display: flex; align-items: center; justify-content: center;
      font-size: 7pt;
      color: white;
      background: transparent;
    }
    .pv-option.chosen .pv-checkbox {
      background: #8b1a1a !important;
      border-color: #8b1a1a !important;
    }
    .pv-opt-name {
      font-family: 'Cormorant Garamond', serif;
      font-size: 12pt;
      font-weight: 600;
      color: #1a1410 !important;
      line-height: 1.2;
    }
    .pv-option.chosen .pv-opt-name { color: #8b1a1a !important; }
    .pv-opt-desc {
      font-size: 8.5pt;
      color: #7a6a5a !important;
      font-style: italic;
      margin-top: 0.5mm;
    }
    .pv-badge {
      display: inline-block;
      background: #8b1a1a !important;
      color: white !important;
      font-size: 5.5pt;
      font-family: 'Cinzel', serif;
      letter-spacing: 0.5px;
      padding: 0.5mm 1.5mm;
      margin-left: 2mm;
      vertical-align: middle;
    }

    /* Note */
    .pv-note-box {
      border: 0.3mm solid #c8b89a;
      padding: 3mm 4mm;
      min-height: 16mm;
      background: rgba(255,255,255,0.4) !important;
    }
    .pv-note-text {
      font-size: 10pt;
      color: #1a1410 !important;
      line-height: 1.6;
    }
    .pv-note-text.empty { color: #b8a898 !important; font-style: italic; }

    /* Legal */
    .pv-legal {
      font-size: 7.5pt;
      line-height: 1.7;
      color: #8a7a6a !important;
      font-style: italic;
      border-top: 0.3mm solid #c8b89a;
      padding-top: 4mm;
    }

    /* Signature block */
    .pv-sig-block {
      display: flex;
      justify-content: flex-end;
      margin-top: 6mm;
    }
    .pv-sig-area {
      text-align: center;
      min-width: 50mm;
    }
    .pv-sig-line {
      border-bottom: 0.4mm solid #1a1410;
      width: 50mm;
      margin-bottom: 2mm;
    }
    .pv-sig-label {
      font-family: 'Cinzel', serif;
      font-size: 6.5pt;
      letter-spacing: 2px;
      color: #7a6a5a !important;
    }

    /* Date footer */
    .pv-date {
      position: absolute;
      bottom: 14mm;
      left: 24mm;
      right: 24mm;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .pv-date-text {
      font-family: 'Cormorant Garamond', serif;
      font-size: 8pt;
      font-style: italic;
      color: #8a7a6a !important;
    }
  }
</style>
</head>
<body>

<div class="document-wrapper">
  <div class="seal">‚ùß</div>
  <div class="document">

    <div class="corner-bl">‚ú¶</div>
    <div class="corner-br">‚ú¶</div>

    <hr class="border-top">

    <h1 class="title">CONTRAT</h1>
    <p class="subtitle">Mise au point sur notre relation</p>

    <div style="height: 32px"></div>

    <!-- Objectif -->
    <div class="section">
      <div class="section-label">Objectif</div>
      <p class="body-text">
        Je souhaite clarifier notre relation pour pr√©venir tout malentendu ou conflit potentiel.
      </p>
    </div>

    <!-- Nom -->
    <div class="section">
      <div class="section-label">Identit√©</div>
      <div class="name-line">
        <span>Je soussign√©(e)</span>
        <input type="text" id="name" placeholder="Votre pr√©nom" maxlength="60">
        <span>, souhaite pr√©ciser que je suis en faveur d'une relation de type :</span>
      </div>
    </div>

    <!-- Type de relation -->
    <div class="section">
      <div class="section-label">Nature de la relation</div>
      <div class="options-grid">

        <label class="option-item" id="opt-serieuse">
          <input type="radio" name="type" value="S√©rieuse">
          <div class="option-box"></div>
          <div class="option-label">
            <span class="option-name">S√©rieuse</span>
            <span class="option-desc">Fid√®le jusqu'√† la mort m√™me au-del√†</span>
          </div>
        </label>

        <label class="option-item" id="opt-sansprise">
          <input type="radio" name="type" value="Sans prise de t√™te">
          <div class="option-box"></div>
          <div class="option-label">
            <span class="option-name">Sans prise de t√™te</span>
            <span class="option-desc">On verra ce que le destin nous r√©serve</span>
          </div>
        </label>

        <label class="option-item" id="opt-ouverte">
          <input type="radio" name="type" value="Ouverte">
          <div class="option-box"></div>
          <div class="option-label">
            <span class="option-name">Ouverte</span>
            <span class="option-desc">C'est que pour faire du cardio</span>
          </div>
        </label>

        <label class="option-item" id="opt-amical">
          <input type="radio" name="type" value="Amical">
          <div class="option-box"></div>
          <div class="option-label">
            <span class="option-name">Amical</span>
            <span class="option-desc">T'es le Sang</span>
          </div>
        </label>

        <label class="option-item special" id="opt-amicalpp">
          <input type="radio" name="type" value="Amical++">
          <div class="option-box"></div>
          <div class="option-label">
            <span class="option-name">Amical++</span>
            <span class="option-desc">L'amiti√©... mais avec des avantages n√©gociables</span>
          </div>
        </label>

      </div>
    </div>

    <!-- Message / Note personnelle -->
    <div class="section">
      <div class="section-label">Note personnelle</div>
      <div class="note-field">
        <textarea id="message" placeholder="Un mot, une pr√©cision, une d√©claration... (optionnel)"></textarea>
      </div>
    </div>

    <!-- Clauses l√©gales -->
    <div class="section">
      <p class="legal">
        Les parties reconnaissent que, suite √† la clarification de leurs attentes et √† la s√©lection d'un type de relation, il est possible que l'interaction ou la communication entre elles √©volue ou prenne fin. Cette d√©cision devra √™tre prise dans un esprit de respect mutuel, sans obligation dans le maintien d'une relation au-del√† de ce qui est souhait√© par l'une ou l'autre des parties.
      </p>
    </div>

    <hr class="border-bottom">

    <button class="submit-btn" onclick="submitContract()">
      ‚ú¶ &nbsp; Signer &amp; Envoyer &nbsp; ‚ú¶
    </button>

    <p class="error-msg" id="error-msg">Veuillez remplir votre pr√©nom et choisir un type de relation.</p>

  </div><!-- .document -->
</div><!-- .document-wrapper -->

<!-- Success overlay -->
<div class="success-overlay" id="success-overlay">
  <div class="success-icon">üíå</div>
  <div class="success-title">Contrat Sign√©</div>
  <p class="success-sub">Votre r√©ponse a bien √©t√© transmise. Le destin en prend note.</p>
  <div style="display:flex; gap:14px; flex-wrap:wrap; justify-content:center; margin-top:30px;">
    <button class="success-close" style="margin-top:0; background:rgba(184,151,42,0.15); border-color:#b8972a; color:#f5f0e8;" onclick="downloadPDF()">
      ‚ú¶ &nbsp;T√âL√âCHARGER LE PDF&nbsp; ‚ú¶
    </button>
    <button class="success-close" style="margin-top:0;" onclick="closeSuccess()">FERMER</button>
  </div>
</div>

<!-- ‚ïê‚ïê‚ïê PRINT VIEW (hidden ‚Äî visible only on print/PDF) ‚ïê‚ïê‚ïê -->
<div id="print-view">
  <div class="pv-page">
    <span class="pv-corner tl">‚ú¶</span>
    <span class="pv-corner tr">‚ú¶</span>
    <span class="pv-corner bl">‚ú¶</span>
    <span class="pv-corner br">‚ú¶</span>

    <div class="pv-seal">‚ùß</div>

    <hr class="pv-hr">
    <div class="pv-title">CONTRAT</div>
    <div class="pv-subtitle">Mise au point sur notre relation</div>
    <div style="height:7mm"></div>

    <!-- Objectif -->
    <div class="pv-section">
      <div class="pv-label">Objectif</div>
      <p class="pv-text">Je souhaite clarifier notre relation pour pr√©venir tout malentendu ou conflit potentiel.</p>
    </div>

    <!-- Identit√© -->
    <div class="pv-section">
      <div class="pv-label">Identit√©</div>
      <p class="pv-text">
        Je soussign√©(e) <span class="pv-name-value" id="pv-name-display">&nbsp;</span>,
        souhaite pr√©ciser que je suis en faveur d'une relation de type :
      </p>
    </div>

    <!-- Nature -->
    <div class="pv-section">
      <div class="pv-label">Nature de la relation</div>
      <div class="pv-options">
        <div class="pv-option" id="pv-opt-serieuse">
          <div class="pv-checkbox" id="pv-check-serieuse"></div>
          <div><div class="pv-opt-name">S√©rieuse</div><div class="pv-opt-desc">Fid√®le jusqu'√† la mort m√™me au-del√†</div></div>
        </div>
        <div class="pv-option" id="pv-opt-sansprise">
          <div class="pv-checkbox" id="pv-check-sansprise"></div>
          <div><div class="pv-opt-name">Sans prise de t√™te</div><div class="pv-opt-desc">On verra ce que le destin nous r√©serve</div></div>
        </div>
        <div class="pv-option" id="pv-opt-ouverte">
          <div class="pv-checkbox" id="pv-check-ouverte"></div>
          <div><div class="pv-opt-name">Ouverte</div><div class="pv-opt-desc">C'est que pour faire du cardio</div></div>
        </div>
        <div class="pv-option" id="pv-opt-amical">
          <div class="pv-checkbox" id="pv-check-amical"></div>
          <div><div class="pv-opt-name">Amical</div><div class="pv-opt-desc">T'es le Sang</div></div>
        </div>
        <div class="pv-option" id="pv-opt-amicalpp">
          <div class="pv-checkbox" id="pv-check-amicalpp"></div>
          <div><div class="pv-opt-name">Amical++</div><div class="pv-opt-desc">L'amiti√©... mais avec des avantages n√©gociables</div></div>
        </div>
      </div>
    </div>

    <!-- Note -->
    <div class="pv-section">
      <div class="pv-label">Note personnelle</div>
      <div class="pv-note-box">
        <div class="pv-note-text" id="pv-message-display"></div>
      </div>
    </div>

    <!-- Legal -->
    <div class="pv-section">
      <p class="pv-legal">Les parties reconnaissent que, suite √† la clarification de leurs attentes et √† la s√©lection d'un type de relation, il est possible que l'interaction ou la communication entre elles √©volue ou prenne fin. Cette d√©cision devra √™tre prise dans un esprit de respect mutuel, sans obligation dans le maintien d'une relation au-del√† de ce qui est souhait√© par l'une ou l'autre des parties.</p>
    </div>

    <hr class="pv-hr bottom">

    <!-- Signature -->
    <div class="pv-sig-block">
      <div class="pv-sig-area">
        <div class="pv-sig-line"></div>
        <div class="pv-sig-label">SIGNATURE</div>
      </div>
    </div>

    <!-- Date footer -->
    <div class="pv-date">
      <span class="pv-date-text" id="pv-date-display"></span>
      <span class="pv-date-text" style="letter-spacing:1px; font-style:normal;">‚ú¶</span>
    </div>
  </div>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script>
  // ‚îÄ‚îÄ‚îÄ CONFIGURATION ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  const GAS_URL = "https://script.google.com/macros/s/AKfycbxCVQhoouL1dFsCrA44CCxwu0Td-iiR2XhwlXVzV_TzPWttnTfBGZsQsu1DUDrQPTo/exec";
  // ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ

  let lastSubmission = {};

  // ‚îÄ‚îÄ Radio visual update ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  document.querySelectorAll('input[type="radio"]').forEach(radio => {
    radio.addEventListener('change', function() {
      document.querySelectorAll('.option-item').forEach(el => el.classList.remove('selected'));
      if (this.checked) this.closest('.option-item').classList.add('selected');
    });
  });

  // ‚îÄ‚îÄ Submit ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  function submitContract() {
    const name   = document.getElementById('name').value.trim();
    const typeEl = document.querySelector('input[name="type"]:checked');
    const errorEl = document.getElementById('error-msg');

    if (!name || !typeEl) {
      errorEl.style.display = 'block';
      errorEl.textContent = 'Veuillez remplir votre pr√©nom et choisir un type de relation.';
      return;
    }
    errorEl.style.display = 'none';

    const type    = typeEl.value;
    const message = document.getElementById('message').value.trim();
    const now     = new Date();
    const dateStr = now.toLocaleDateString('fr-FR', { day: '2-digit', month: 'long', year: 'numeric' });
    // DD-MM-YYYY for signature
    const pad = n => String(n).padStart(2,'0');
    const dateSig = pad(now.getDate()) + '-' + pad(now.getMonth()+1) + '-' + now.getFullYear();

    lastSubmission = { name, type, message, date: dateStr, dateSig };

    const btn = document.querySelector('.submit-btn');
    btn.textContent = '\u2726  Envoi en cours...  \u2726';
    btn.disabled = true;

    const payload = { name, type, message: message || '(aucune note)', date: dateStr };

    fetch(GAS_URL, {
      method : 'POST',
      headers: { 'Content-Type': 'text/plain;charset=utf-8' },
      body   : JSON.stringify(payload)
    })
    .then(res => res.json().catch(() => ({})))
    .then(() => showSuccess())
    .catch(err => {
      console.warn('GAS fetch error:', err);
      fallbackMailto(name, type, message, dateStr);
    })
    .finally(() => {
      btn.disabled = false;
      btn.textContent = '\u2726   Signer & Envoyer   \u2726';
    });
  }

  function fallbackMailto(name, type, message, dateStr) {
    const subject = `\u{1F4DC} Contrat sign\u00e9 par ${name} \u2014 ${type}`;
    const body = `CONTRAT \u2014 Mise au point sur notre relation\n\nSignataire  : ${name}\nDate        : ${dateStr}\nType choisi : ${type}\n\nNote personnelle :\n${message || '(aucune)'}\n\n\u2014 Envoy\u00e9 depuis le Contrat de Relation`;
    window.open(`mailto:?subject=${encodeURIComponent(subject)}&body=${encodeURIComponent(body)}`);
    showSuccess();
  }

  function showSuccess() {
    document.getElementById('success-overlay').classList.add('show');
  }

  // ‚îÄ‚îÄ Download PDF via html2canvas + jsPDF ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  async function downloadPDF() {
    const { name, type, message, dateSig } = lastSubmission;

    document.getElementById('success-overlay').classList.remove('show');

    // Show loading indicator
    const loadingEl = document.createElement('div');
    loadingEl.id = 'pdf-loading';
    loadingEl.style.cssText = 'position:fixed;inset:0;background:rgba(26,20,16,0.85);z-index:200;display:flex;flex-direction:column;align-items:center;justify-content:center;';
    loadingEl.innerHTML = '<div style="font-family:Cinzel,serif;color:#f5f0e8;font-size:13px;letter-spacing:4px;margin-bottom:14px;">G\u00c9N\u00c9RATION DU PDF...</div><div id="pdf-spinner" style="width:36px;height:36px;border:2px solid rgba(184,151,42,0.3);border-top-color:#b8972a;border-radius:50%;animation:spin 0.8s linear infinite;"></div>';
    document.body.appendChild(loadingEl);

    // Build A4 container off-screen
    const container = document.createElement('div');
    container.style.cssText = 'position:fixed;left:-9999px;top:0;width:794px;min-height:1123px;background:#f5f0e8;box-sizing:border-box;font-family:EB Garamond,Georgia,serif;';
    container.innerHTML = buildPDFContainerHTML(name, type, message, dateSig);
    document.body.appendChild(container);

    // Wait for fonts to be ready
    await document.fonts.ready;
    // Extra tick for layout
    await new Promise(r => setTimeout(r, 200));

    try {
      const canvas = await html2canvas(container, {
        scale: 2.5,
        useCORS: true,
        allowTaint: true,
        backgroundColor: '#f5f0e8',
        width: 794,
        scrollX: 0,
        scrollY: 0,
        windowWidth: 794
      });

      const { jsPDF } = window.jspdf;
      const pdf = new jsPDF({ orientation: 'portrait', unit: 'mm', format: 'a4' });

      const pageW = 210;
      const pageH = 297;
      const imgW  = canvas.width;
      const imgH  = canvas.height;
      const ratio = pageW / (imgW / 2.5); // account for scale factor
      const renderedH = (imgH / 2.5) * ratio;

      const imgData = canvas.toDataURL('image/jpeg', 0.97);

      if (renderedH <= pageH) {
        pdf.addImage(imgData, 'JPEG', 0, 0, pageW, renderedH);
      } else {
        // Multi-page: slice image
        const sliceH_px  = Math.floor((pageH / renderedH) * imgH);
        let   offsetY_px = 0;
        let   page       = 0;
        while (offsetY_px < imgH) {
          if (page > 0) pdf.addPage();
          const sliceCanvas = document.createElement('canvas');
          sliceCanvas.width  = imgW;
          sliceCanvas.height = Math.min(sliceH_px, imgH - offsetY_px);
          const ctx = sliceCanvas.getContext('2d');
          ctx.drawImage(canvas, 0, offsetY_px, imgW, sliceCanvas.height, 0, 0, imgW, sliceCanvas.height);
          const sliceData = sliceCanvas.toDataURL('image/jpeg', 0.97);
          const sliceRenderedH = (sliceCanvas.height / imgH) * renderedH;
          pdf.addImage(sliceData, 'JPEG', 0, 0, pageW, sliceRenderedH);
          offsetY_px += sliceH_px;
          page++;
        }
      }

      const fname = 'Contrat_' + (name || 'relation').replace(/\s+/g, '_') + '.pdf';
      pdf.save(fname);

    } catch(err) {
      console.error('PDF generation error:', err);
      alert('Erreur lors de la g\u00e9n\u00e9ration du PDF. Essayez de r\u00e9-ouvrir la page et de resoumettre.');
    } finally {
      document.body.removeChild(container);
      document.body.removeChild(loadingEl);
    }
  }

  // ‚îÄ‚îÄ Build the HTML content captured by html2canvas ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  // Mirrors the .document div design using inline styles only
  function buildPDFContainerHTML(name, type, message, dateSig) {
    const gold    = '#b8972a';
    const red     = '#8b1a1a';
    const ink     = '#1a1410';
    const inkL    = '#3d3028';
    const border  = '#c8b89a';
    const paper   = '#f5f0e8';

    const labelStyle =
      'font-family:Cinzel,serif;font-size:11px;font-weight:600;letter-spacing:3px;' +
      'color:' + gold + ';text-transform:uppercase;margin-bottom:8px;padding-bottom:5px;' +
      'border-bottom:1px solid ' + border + ';display:block;';

    const sectionStyle = 'margin-bottom:22px;';

    const options = [
      { val:'S\u00e9rieuse',            desc:"Fid\u00e8le jusqu'\u00e0 la mort m\u00eame au-del\u00e0" },
      { val:'Sans prise de t\u00eate',  desc:"On verra ce que le destin nous r\u00e9serve" },
      { val:'Ouverte',                  desc:"C'est que pour faire du cardio" },
      { val:'Amical',                   desc:"T'es le Sang" },
      { val:'Amical++',                 desc:"L'amiti\u00e9... mais avec des avantages n\u00e9gociables" }
    ];

    const optionsHTML = options.map(opt => {
      const chosen   = (opt.val === type);
      const rowBg    = chosen ? 'background:rgba(139,26,26,0.06);border:1px solid ' + red + ';' : 'border:1px solid transparent;';
      const boxBg    = chosen ? 'background:' + red + ';border:1.5px solid ' + red + ';' : 'background:transparent;border:1.5px solid ' + border + ';';
      const nameColor= chosen ? red : ink;
      return (
        '<div style="display:flex;align-items:flex-start;gap:12px;padding:10px 14px;margin-bottom:6px;border-radius:2px;' + rowBg + '">' +
          '<div style="width:16px;height:16px;flex-shrink:0;margin-top:3px;display:flex;align-items:center;justify-content:center;font-size:10px;color:white;' + boxBg + '">' +
            (chosen ? '\u2713' : '') +
          '</div>' +
          '<div>' +
            '<div style="font-family:Cormorant Garamond,Georgia,serif;font-size:16px;font-weight:600;color:' + nameColor + ';line-height:1.2;">' + opt.val + '</div>' +
            '<div style="font-size:12px;color:#7a6a5a;font-style:italic;margin-top:2px;">' + opt.desc + '</div>' +
          '</div>' +
        '</div>'
      );
    }).join('');

    const noteHTML = message && message !== '(aucune note)'
      ? '<span style="font-size:14px;color:' + ink + ';line-height:1.6;">' + message.replace(/\n/g,'<br>') + '</span>'
      : '<span style="font-size:14px;color:#b8a898;font-style:italic;">aucune note</span>';

    // Decorative HR gradient ‚Äî use a table trick for compatibility with html2canvas
    const hrGold = '<div style="height:2px;background:linear-gradient(90deg,transparent,' + gold + ',' + border + ',' + gold + ',transparent);opacity:0.65;margin:4px -20px 24px;"></div>';

    // Corner ornaments
    const corners =
      '<div style="position:absolute;top:16px;left:16px;color:' + gold + ';font-size:10px;opacity:0.5;">\u2726</div>' +
      '<div style="position:absolute;top:16px;right:16px;color:' + gold + ';font-size:10px;opacity:0.5;">\u2726</div>' +
      '<div style="position:absolute;bottom:16px;left:16px;color:' + gold + ';font-size:10px;opacity:0.5;">\u2726</div>' +
      '<div style="position:absolute;bottom:16px;right:16px;color:' + gold + ';font-size:10px;opacity:0.5;">\u2726</div>';

    // Wax seal
    const seal =
      '<div style="width:52px;height:52px;border-radius:50%;background:radial-gradient(circle at 40% 35%,#c0392b,#7b1a1a);' +
      'margin:0 auto 0;display:flex;align-items:center;justify-content:center;' +
      'font-size:18px;color:rgba(255,255,255,0.65);box-shadow:0 4px 16px rgba(139,26,26,0.4);">\u2767</div>';

    return (
      '<div style="position:relative;background:' + paper + ';padding:56px 64px 48px;min-height:1100px;box-sizing:border-box;border:1px solid ' + border + ';">' +
        corners +
        seal +
        '<div style="height:24px;"></div>' +
        hrGold +
        '<h1 style="font-family:Cinzel,serif;font-size:26px;font-weight:600;letter-spacing:8px;text-align:center;color:' + ink + ';margin:0 0 6px;">CONTRAT</h1>' +
        '<p style="font-family:Cormorant Garamond,Georgia,serif;font-style:italic;font-size:15px;text-align:center;color:' + inkL + ';letter-spacing:1px;margin:0 0 28px;">Mise au point sur notre relation</p>' +

        // Objectif
        '<div style="' + sectionStyle + '">' +
          '<span style="' + labelStyle + '">Objectif</span>' +
          '<p style="font-size:14px;line-height:1.75;color:' + inkL + ';font-style:italic;margin:0;">Je souhaite clarifier notre relation pour pr\u00e9venir tout malentendu ou conflit potentiel.</p>' +
        '</div>' +

        // Identit\u00e9
        '<div style="' + sectionStyle + '">' +
          '<span style="' + labelStyle + '">Identit\u00e9</span>' +
          '<p style="font-size:14px;line-height:1.75;color:' + inkL + ';font-style:italic;margin:0;">' +
            'Je soussign\u00e9(e)\u00a0' +
            '<span style="font-style:normal;color:' + ink + ';font-weight:600;border-bottom:1.5px solid ' + gold + ';padding:0 8px;display:inline-block;text-align:center;min-width:100px;">' + name + '</span>' +
            ',\u00a0souhaite pr\u00e9ciser que je suis en faveur d\u2019une relation de type\u00a0:' +
          '</p>' +
        '</div>' +

        // Nature
        '<div style="' + sectionStyle + '">' +
          '<span style="' + labelStyle + '">Nature de la relation</span>' +
          optionsHTML +
        '</div>' +

        // Note
        '<div style="' + sectionStyle + '">' +
          '<span style="' + labelStyle + '">Note personnelle</span>' +
          '<div style="border:1px solid ' + border + ';padding:10px 14px;min-height:60px;background:rgba(255,255,255,0.45);">' + noteHTML + '</div>' +
        '</div>' +

        // Legal
        '<div style="border-top:1px solid ' + border + ';padding-top:14px;margin-bottom:24px;">' +
          '<p style="font-size:11px;line-height:1.7;color:#8a7a6a;font-style:italic;margin:0;">' +
            'Les parties reconnaissent que, suite \u00e0 la clarification de leurs attentes et \u00e0 la s\u00e9lection d\u2019un type de relation, il est possible que l\u2019interaction ou la communication entre elles \u00e9volue ou prenne fin. Cette d\u00e9cision devra \u00eatre prise dans un esprit de respect mutuel, sans obligation dans le maintien d\u2019une relation au-del\u00e0 de ce qui est souhait\u00e9 par l\u2019une ou l\u2019autre des parties.' +
          '</p>' +
        '</div>' +

        '<div style="height:2px;background:linear-gradient(90deg,transparent,' + gold + ',' + border + ',' + gold + ',transparent);opacity:0.65;margin:0 -20px 24px;"></div>' +

        // Signature block
        '<div style="text-align:right;margin-top:8px;">' +
          '<div style="display:inline-block;text-align:center;min-width:180px;">' +
            '<div style="border-top:1.5px solid ' + ink + ';padding-top:6px;">' +
              '<div style="font-family:Cinzel,serif;font-size:10px;letter-spacing:2px;color:#7a6a5a;margin-bottom:4px;">SIGNATURE √âLECTRONIQUE</div>' +
              '<div style="font-family:Cormorant Garamond,Georgia,serif;font-style:italic;font-size:13px;color:' + inkL + ';">Sign\u00e9 par <strong style="color:' + ink + ';">' + name + '</strong><br>le ' + dateSig + '</div>' +
            '</div>' +
          '</div>' +
        '</div>' +

      '</div>'
    );
  }

  function closeSuccess() {
    document.getElementById('success-overlay').classList.remove('show');
    document.getElementById('name').value = '';
    document.getElementById('message').value = '';
    document.querySelectorAll('input[type="radio"]').forEach(r => r.checked = false);
    document.querySelectorAll('.option-item').forEach(el => el.classList.remove('selected'));
    lastSubmission = {};
  }
</script>
</body>
