<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Contrat ‚Äî Mise au point sur notre relation</title>
<link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:ital,wght@0,300;0,400;0,600;1,300;1,400&family=EB+Garamond:ital,wght@0,400;0,500;1,400&family=Cinzel:wght@400;600&display=swap" rel="stylesheet">

<style>
  :root {
    --paper: #f5f0e8;
    --ink: #1a1410;
    --ink-light: #3d3028;
    --gold: #b8972a;
    --gold-light: #d4b44a;
    --red: #8b1a1a;
    --border: #c8b89a;
    --shadow: rgba(26, 20, 16, 0.15);
  }

  * { box-sizing: border-box; margin: 0; padding: 0; }

  body {
    background: #2a1f14;
    background-image: 
      radial-gradient(ellipse at 20% 50%, #3d2d1a 0%, transparent 60%),
      radial-gradient(ellipse at 80% 20%, #1a1410 0%, transparent 60%);
    min-height: 100vh;
    display: flex;
    align-items: flex-start;
    justify-content: center;
    padding: 40px 20px;
    font-family: 'EB Garamond', serif;
  }

  .document-wrapper {
    position: relative;
    max-width: 680px;
    width: 100%;
  }

  /* Wax seal decoration */
  .seal {
    position: absolute;
    top: -28px;
    left: 50%;
    transform: translateX(-50%);
    width: 56px;
    height: 56px;
    background: radial-gradient(circle at 40% 35%, #c0392b, #7b1a1a);
    border-radius: 50%;
    box-shadow: 0 4px 20px rgba(139,26,26,0.5), inset 0 -2px 4px rgba(0,0,0,0.3);
    display: flex;
    align-items: center;
    justify-content: center;
    font-family: 'Cinzel', serif;
    color: rgba(255,255,255,0.6);
    font-size: 18px;
    z-index: 10;
    letter-spacing: -1px;
  }
  .seal::after {
    content: '';
    position: absolute;
    inset: 3px;
    border-radius: 50%;
    border: 1px solid rgba(255,255,255,0.2);
  }

  .document {
    background: var(--paper);
    background-image: 
      url("data:image/svg+xml,%3Csvg width='200' height='200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noise'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='4' stitchTiles='stitch'/%3E%3CfeColorMatrix type='saturate' values='0'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noise)' opacity='0.04'/%3E%3C/svg%3E");
    border: 1px solid var(--border);
    padding: 60px 70px 50px;
    box-shadow: 
      0 20px 60px rgba(0,0,0,0.4),
      0 0 0 8px rgba(245,240,232,0.03),
      inset 0 1px 0 rgba(255,255,255,0.5);
    position: relative;
    animation: fadeIn 0.8s ease both;
  }

  /* Corner ornaments */
  .document::before, .document::after {
    content: '‚ú¶';
    position: absolute;
    color: var(--gold);
    font-size: 10px;
    opacity: 0.5;
  }
  .document::before { top: 18px; left: 18px; }
  .document::after { top: 18px; right: 18px; }

  .corner-bl, .corner-br {
    position: absolute;
    bottom: 18px;
    color: var(--gold);
    font-size: 10px;
    opacity: 0.5;
  }
  .corner-bl { left: 18px; }
  .corner-br { right: 18px; }

  /* Decorative border lines */
  .border-top, .border-bottom {
    border: none;
    height: 2px;
    background: linear-gradient(90deg, transparent, var(--gold), var(--border), var(--gold), transparent);
    margin: 0 -20px;
    opacity: 0.6;
  }
  .border-top { margin-bottom: 28px; }
  .border-bottom { margin-top: 28px; }

  h1.title {
    font-family: 'Cinzel', serif;
    font-size: 28px;
    font-weight: 600;
    letter-spacing: 8px;
    text-align: center;
    color: var(--ink);
    margin-bottom: 6px;
  }

  .subtitle {
    font-family: 'Cormorant Garamond', serif;
    font-style: italic;
    font-size: 17px;
    text-align: center;
    color: var(--ink-light);
    letter-spacing: 1px;
    margin-bottom: 0;
  }

  .section {
    margin-bottom: 24px;
    animation: slideUp 0.6s ease both;
  }

  .section:nth-child(1) { animation-delay: 0.1s; }
  .section:nth-child(2) { animation-delay: 0.2s; }
  .section:nth-child(3) { animation-delay: 0.3s; }

  .section-label {
    font-family: 'Cinzel', serif;
    font-size: 13px;
    font-weight: 600;
    letter-spacing: 3px;
    color: var(--gold);
    text-transform: uppercase;
    margin-bottom: 8px;
    display: flex;
    align-items: center;
    gap: 8px;
  }
  .section-label::after {
    content: '';
    flex: 1;
    height: 1px;
    background: linear-gradient(90deg, var(--border), transparent);
  }

  p.body-text {
    font-size: 17px;
    line-height: 1.75;
    color: var(--ink-light);
    font-style: italic;
  }

  .name-line {
    display: flex;
    align-items: baseline;
    gap: 10px;
    flex-wrap: wrap;
    font-size: 17px;
    color: var(--ink-light);
    line-height: 1.75;
    font-style: italic;
  }

  .name-line input[type="text"] {
    background: transparent;
    border: none;
    border-bottom: 1.5px solid var(--gold);
    padding: 2px 8px;
    font-family: 'EB Garamond', serif;
    font-size: 17px;
    color: var(--ink);
    outline: none;
    min-width: 140px;
    flex: 1;
    max-width: 220px;
    text-align: center;
    transition: border-color 0.2s;
  }
  .name-line input[type="text"]:focus {
    border-bottom-color: var(--red);
  }
  .name-line input[type="text"]::placeholder {
    color: #c8b89a;
    font-style: italic;
  }

  /* Checkbox options */
  .options-grid {
    display: flex;
    flex-direction: column;
    gap: 10px;
    margin-top: 6px;
  }

  .option-item {
    display: flex;
    align-items: flex-start;
    gap: 14px;
    padding: 12px 16px;
    border: 1px solid transparent;
    border-radius: 3px;
    cursor: pointer;
    transition: all 0.25s ease;
    position: relative;
  }

  .option-item:hover {
    background: rgba(184,151,42,0.06);
    border-color: var(--border);
  }

  .option-item.selected {
    background: rgba(139,26,26,0.05);
    border-color: var(--red);
  }
  .option-item.selected .option-box {
    background: var(--red);
    border-color: var(--red);
  }
  .option-item.selected .option-box::after {
    opacity: 1;
    transform: scale(1);
  }

  .option-item input[type="radio"] {
    position: absolute;
    opacity: 0;
    pointer-events: none;
  }

  .option-box {
    width: 18px;
    height: 18px;
    border: 1.5px solid var(--border);
    flex-shrink: 0;
    margin-top: 2px;
    position: relative;
    transition: all 0.2s;
    display: flex;
    align-items: center;
    justify-content: center;
  }
  .option-box::after {
    content: '‚úì';
    color: white;
    font-size: 11px;
    opacity: 0;
    transform: scale(0.5);
    transition: all 0.2s;
  }

  .option-label {
    display: flex;
    flex-direction: column;
  }
  .option-name {
    font-family: 'Cormorant Garamond', serif;
    font-size: 17px;
    font-weight: 600;
    color: var(--ink);
    line-height: 1.2;
  }
  .option-desc {
    font-size: 15px;
    color: #7a6a5a;
    font-style: italic;
    margin-top: 2px;
  }



  /* Note / message field */
  .note-field {
    margin-top: 6px;
  }
  .note-field textarea {
    width: 100%;
    background: rgba(255,255,255,0.4);
    border: 1px solid var(--border);
    padding: 10px 14px;
    font-family: 'EB Garamond', serif;
    font-size: 16px;
    color: var(--ink);
    resize: vertical;
    min-height: 80px;
    outline: none;
    transition: border-color 0.2s;
    line-height: 1.6;
  }
  .note-field textarea:focus {
    border-color: var(--gold);
  }
  .note-field textarea::placeholder {
    color: #b8a898;
    font-style: italic;
  }

  /* Legal fine print */
  .legal {
    font-size: 15px;
    line-height: 1.7;
    color: #8a7a6a;
    font-style: italic;
    border-top: 1px solid var(--border);
    padding-top: 16px;
    margin-top: 8px;
  }

  /* Submit button */
  .submit-btn {
    display: block;
    width: 100%;
    margin-top: 28px;
    padding: 14px 30px;
    background: var(--ink);
    color: var(--paper);
    border: none;
    font-family: 'Cinzel', serif;
    font-size: 12px;
    letter-spacing: 4px;
    text-transform: uppercase;
    cursor: pointer;
    position: relative;
    overflow: hidden;
    transition: all 0.3s;
  }
  .submit-btn::before {
    content: '';
    position: absolute;
    inset: 0;
    background: linear-gradient(90deg, transparent, rgba(184,151,42,0.15), transparent);
    transform: translateX(-100%);
    transition: transform 0.5s;
  }
  .submit-btn:hover::before {
    transform: translateX(100%);
  }
  .submit-btn:hover {
    background: var(--red);
    letter-spacing: 6px;
  }
  .submit-btn:active {
    transform: scale(0.99);
  }

  /* Success overlay */
  .success-overlay {
    display: none;
    position: fixed;
    inset: 0;
    background: rgba(26,20,16,0.92);
    z-index: 100;
    align-items: center;
    justify-content: center;
    flex-direction: column;
    text-align: center;
    padding: 40px;
  }
  .success-overlay.show { display: flex; animation: fadeIn 0.4s ease; }
  .success-icon {
    font-size: 48px;
    margin-bottom: 20px;
    animation: pulse 1s ease infinite alternate;
  }
  .success-title {
    font-family: 'Cinzel', serif;
    font-size: 22px;
    letter-spacing: 4px;
    color: var(--paper);
    margin-bottom: 10px;
  }
  .success-sub {
    font-family: 'Cormorant Garamond', serif;
    font-style: italic;
    font-size: 16px;
    color: #b8a898;
    max-width: 360px;
  }
  .success-close {
    margin-top: 30px;
    padding: 10px 28px;
    background: transparent;
    border: 1px solid var(--border);
    color: var(--paper);
    font-family: 'Cinzel', serif;
    font-size: 11px;
    letter-spacing: 3px;
    cursor: pointer;
    transition: all 0.2s;
  }
  .success-close:hover { background: var(--paper); color: var(--ink); }

  /* Error message */
  .error-msg {
    display: none;
    color: var(--red);
    font-size: 13px;
    font-style: italic;
    text-align: center;
    margin-top: 10px;
  }

  @keyframes fadeIn { from { opacity: 0 } to { opacity: 1 } }
  @keyframes slideUp { from { opacity: 0; transform: translateY(12px) } to { opacity: 1; transform: none } }
  
  @keyframes spin { to { transform: rotate(360deg) } }
  @keyframes pulse { from { transform: scale(1) } to { transform: scale(1.1) } }

  /* Mobile */
  @media (max-width: 600px) {
    .document { padding: 50px 28px 40px; }
    h1.title { font-size: 20px; letter-spacing: 5px; }
  }

  /* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
     PDF / PRINT VIEW
  ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
  #print-view { display: none; }

  @media print {
    @page { size: A4; margin: 0; }

    *, *::before, *::after { -webkit-print-color-adjust: exact !important; print-color-adjust: exact !important; }

    body {
      background: #f5f0e8 !important;
      display: block !important;
      padding: 0 !important;
      margin: 0 !important;
    }

    /* Hide everything except print view */
    .document-wrapper, .success-overlay { display: none !important; }

    #print-view {
      display: block !important;
    }

    .pv-page {
      width: 210mm;
      min-height: 297mm;
      padding: 28mm 24mm 24mm;
      background: #f5f0e8 !important;
      box-sizing: border-box;
      position: relative;
      font-family: 'EB Garamond', serif;
    }

    /* Corners */
    .pv-corner { position: absolute; color: #b8972a; font-size: 9px; opacity: 0.55; }
    .pv-corner.tl { top: 16mm; left: 16mm; }
    .pv-corner.tr { top: 16mm; right: 16mm; }
    .pv-corner.bl { bottom: 16mm; left: 16mm; }
    .pv-corner.br { bottom: 16mm; right: 16mm; }

    /* Decorative HR */
    .pv-hr {
      border: none;
      height: 2px;
      background: linear-gradient(90deg, transparent, #b8972a, #c8b89a, #b8972a, transparent) !important;
      opacity: 0.65;
      margin: 0 -10mm 8mm;
    }
    .pv-hr.bottom { margin: 8mm -10mm 0; }

    /* Wax seal */
    .pv-seal {
      width: 14mm; height: 14mm;
      background: radial-gradient(circle at 40% 35%, #c0392b, #7b1a1a) !important;
      border-radius: 50%;
      margin: 0 auto 6mm;
      display: flex; align-items: center; justify-content: center;
      color: rgba(255,255,255,0.6);
      font-size: 16px;
    }

    .pv-title {
      font-family: 'Cinzel', serif;
      font-size: 22pt;
      font-weight: 600;
      letter-spacing: 7px;
      text-align: center;
      color: #1a1410 !important;
      margin-bottom: 3mm;
    }
    .pv-subtitle {
      font-family: 'Cormorant Garamond', serif;
      font-style: italic;
      font-size: 11pt;
      text-align: center;
      color: #3d3028 !important;
      letter-spacing: 1px;
      margin-bottom: 0;
    }

    .pv-section { margin-bottom: 7mm; }

    .pv-label {
      font-family: 'Cinzel', serif;
      font-size: 7.5pt;
      font-weight: 600;
      letter-spacing: 2.5px;
      color: #b8972a !important;
      text-transform: uppercase;
      margin-bottom: 2.5mm;
      display: flex;
      align-items: center;
      gap: 4mm;
    }
    .pv-label::after {
      content: '';
      flex: 1;
      height: 0.4mm;
      background: linear-gradient(90deg, #c8b89a, transparent) !important;
    }

    .pv-text {
      font-size: 10.5pt;
      line-height: 1.75;
      color: #3d3028 !important;
      font-style: italic;
    }

    /* Signed name line */
    .pv-name-line {
      font-size: 10.5pt;
      color: #3d3028 !important;
      font-style: italic;
      line-height: 1.75;
    }
    .pv-name-value {
      font-style: normal;
      color: #1a1410 !important;
      font-weight: 500;
      border-bottom: 0.4mm solid #b8972a;
      padding: 0 3mm;
      display: inline-block;
      min-width: 30mm;
      text-align: center;
    }

    /* Options list */
    .pv-options { margin-top: 2mm; }
    .pv-option {
      display: flex;
      align-items: flex-start;
      gap: 4mm;
      padding: 2.5mm 3mm;
      margin-bottom: 1.5mm;
      border: 0.3mm solid transparent;
      border-radius: 1mm;
    }
    .pv-option.chosen {
      background: rgba(139,26,26,0.04) !important;
      border-color: #8b1a1a !important;
    }
    .pv-checkbox {
      width: 4mm; height: 4mm;
      border: 0.4mm solid #c8b89a;
      flex-shrink: 0;
      margin-top: 0.8mm;
      display: flex; align-items: center; justify-content: center;
      font-size: 7pt;
      color: white;
      background: transparent;
    }
    .pv-option.chosen .pv-checkbox {
      background: #8b1a1a !important;
      border-color: #8b1a1a !important;
    }
    .pv-opt-name {
      font-family: 'Cormorant Garamond', serif;
      font-size: 12pt;
      font-weight: 600;
      color: #1a1410 !important;
      line-height: 1.2;
    }
    .pv-option.chosen .pv-opt-name { color: #8b1a1a !important; }
    .pv-opt-desc {
      font-size: 8.5pt;
      color: #7a6a5a !important;
      font-style: italic;
      margin-top: 0.5mm;
    }
    .pv-badge {
      display: inline-block;
      background: #8b1a1a !important;
      color: white !important;
      font-size: 5.5pt;
      font-family: 'Cinzel', serif;
      letter-spacing: 0.5px;
      padding: 0.5mm 1.5mm;
      margin-left: 2mm;
      vertical-align: middle;
    }

    /* Note */
    .pv-note-box {
      border: 0.3mm solid #c8b89a;
      padding: 3mm 4mm;
      min-height: 16mm;
      background: rgba(255,255,255,0.4) !important;
    }
    .pv-note-text {
      font-size: 10pt;
      color: #1a1410 !important;
      line-height: 1.6;
    }
    .pv-note-text.empty { color: #b8a898 !important; font-style: italic; }

    /* Legal */
    .pv-legal {
      font-size: 7.5pt;
      line-height: 1.7;
      color: #8a7a6a !important;
      font-style: italic;
      border-top: 0.3mm solid #c8b89a;
      padding-top: 4mm;
    }

    /* Signature block */
    .pv-sig-block {
      display: flex;
      justify-content: flex-end;
      margin-top: 6mm;
    }
    .pv-sig-area {
      text-align: center;
      min-width: 50mm;
    }
    .pv-sig-line {
      border-bottom: 0.4mm solid #1a1410;
      width: 50mm;
      margin-bottom: 2mm;
    }
    .pv-sig-label {
      font-family: 'Cinzel', serif;
      font-size: 6.5pt;
      letter-spacing: 2px;
      color: #7a6a5a !important;
    }

    /* Date footer */
    .pv-date {
      position: absolute;
      bottom: 14mm;
      left: 24mm;
      right: 24mm;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .pv-date-text {
      font-family: 'Cormorant Garamond', serif;
      font-size: 8pt;
      font-style: italic;
      color: #8a7a6a !important;
    }
  }
</style>
</head>
<body>

<div class="document-wrapper">
  <div class="seal">‚ùß</div>
  <div class="document">

    <div class="corner-bl">‚ú¶</div>
    <div class="corner-br">‚ú¶</div>

    <hr class="border-top">

    <h1 class="title">CONTRAT</h1>
    <p class="subtitle">Mise au point sur notre relation</p>

    <div style="height: 32px"></div>

    <!-- Objectif -->
    <div class="section">
      <div class="section-label">Objectif</div>
      <p class="body-text">
        Je souhaite clarifier notre relation pour pr√©venir tout malentendu ou conflit potentiel.
      </p>
    </div>

    <!-- Nom -->
    <div class="section">
      <div class="section-label">Identit√©</div>
      <div class="name-line">
        <span>Je soussign√©(e)</span>
        <input type="text" id="name" placeholder="Votre pr√©nom" maxlength="60">
        <span>, souhaite pr√©ciser que je suis en faveur d'une relation de type :</span>
      </div>
    </div>

    <!-- Type de relation -->
    <div class="section">
      <div class="section-label">Nature de la relation</div>
      <div class="options-grid">

        <label class="option-item" id="opt-serieuse">
          <input type="radio" name="type" value="S√©rieuse">
          <div class="option-box"></div>
          <div class="option-label">
            <span class="option-name">S√©rieuse</span>
            <span class="option-desc">Fid√®le jusqu'√† la mort m√™me au-del√†</span>
          </div>
        </label>

        <label class="option-item" id="opt-sansprise">
          <input type="radio" name="type" value="Sans prise de t√™te">
          <div class="option-box"></div>
          <div class="option-label">
            <span class="option-name">Sans prise de t√™te</span>
            <span class="option-desc">On verra ce que le destin nous r√©serve</span>
          </div>
        </label>

        <label class="option-item" id="opt-ouverte">
          <input type="radio" name="type" value="Ouverte">
          <div class="option-box"></div>
          <div class="option-label">
            <span class="option-name">Ouverte</span>
            <span class="option-desc">C'est que pour faire du cardio</span>
          </div>
        </label>

        <label class="option-item" id="opt-amical">
          <input type="radio" name="type" value="Amical">
          <div class="option-box"></div>
          <div class="option-label">
            <span class="option-name">Amical</span>
            <span class="option-desc">T'es le Sang</span>
          </div>
        </label>

        <label class="option-item special" id="opt-amicalpp">
          <input type="radio" name="type" value="Amical++">
          <div class="option-box"></div>
          <div class="option-label">
            <span class="option-name">Amical++</span>
            <span class="option-desc">L'amiti√©... mais avec des avantages n√©gociables</span>
          </div>
        </label>

      </div>
    </div>

    <!-- Message / Note personnelle -->
    <div class="section">
      <div class="section-label">Note personnelle</div>
      <div class="note-field">
        <textarea id="message" placeholder="Un mot, une pr√©cision, une d√©claration... (optionnel)"></textarea>
      </div>
    </div>

    <!-- Clauses l√©gales -->
    <div class="section">
      <p class="legal">
        Les parties reconnaissent que, suite √† la clarification de leurs attentes et √† la s√©lection d'un type de relation, il est possible que l'interaction ou la communication entre elles √©volue ou prenne fin. Cette d√©cision devra √™tre prise dans un esprit de respect mutuel, sans obligation dans le maintien d'une relation au-del√† de ce qui est souhait√© par l'une ou l'autre des parties.
      </p>
    </div>

    <hr class="border-bottom">

    <button class="submit-btn" onclick="submitContract()">
      ‚ú¶ &nbsp; Signer &amp; Envoyer &nbsp; ‚ú¶
    </button>

    <p class="error-msg" id="error-msg">Veuillez remplir votre pr√©nom et choisir un type de relation.</p>

  </div><!-- .document -->
</div><!-- .document-wrapper -->

<!-- Success overlay -->
<div class="success-overlay" id="success-overlay">
  <div class="success-icon">üíå</div>
  <div class="success-title">Contrat Sign√©</div>
  <p class="success-sub">Votre r√©ponse a bien √©t√© transmise. Le destin en prend note.</p>
  <div style="display:flex; gap:14px; flex-wrap:wrap; justify-content:center; margin-top:30px;">
    <button class="success-close" style="margin-top:0; background:rgba(184,151,42,0.15); border-color:#b8972a; color:#f5f0e8;" onclick="downloadPDF()">
      ‚ú¶ &nbsp;T√âL√âCHARGER LE PDF&nbsp; ‚ú¶
    </button>
    <button class="success-close" style="margin-top:0;" onclick="closeSuccess()">FERMER</button>
  </div>
</div>

<!-- ‚ïê‚ïê‚ïê PRINT VIEW (hidden ‚Äî visible only on print/PDF) ‚ïê‚ïê‚ïê -->
<div id="print-view">
  <div class="pv-page">
    <span class="pv-corner tl">‚ú¶</span>
    <span class="pv-corner tr">‚ú¶</span>
    <span class="pv-corner bl">‚ú¶</span>
    <span class="pv-corner br">‚ú¶</span>

    <div class="pv-seal">‚ùß</div>

    <hr class="pv-hr">
    <div class="pv-title">CONTRAT</div>
    <div class="pv-subtitle">Mise au point sur notre relation</div>
    <div style="height:7mm"></div>

    <!-- Objectif -->
    <div class="pv-section">
      <div class="pv-label">Objectif</div>
      <p class="pv-text">Je souhaite clarifier notre relation pour pr√©venir tout malentendu ou conflit potentiel.</p>
    </div>

    <!-- Identit√© -->
    <div class="pv-section">
      <div class="pv-label">Identit√©</div>
      <p class="pv-text">
        Je soussign√©(e) <span class="pv-name-value" id="pv-name-display">&nbsp;</span>,
        souhaite pr√©ciser que je suis en faveur d'une relation de type :
      </p>
    </div>

    <!-- Nature -->
    <div class="pv-section">
      <div class="pv-label">Nature de la relation</div>
      <div class="pv-options">
        <div class="pv-option" id="pv-opt-serieuse">
          <div class="pv-checkbox" id="pv-check-serieuse"></div>
          <div><div class="pv-opt-name">S√©rieuse</div><div class="pv-opt-desc">Fid√®le jusqu'√† la mort m√™me au-del√†</div></div>
        </div>
        <div class="pv-option" id="pv-opt-sansprise">
          <div class="pv-checkbox" id="pv-check-sansprise"></div>
          <div><div class="pv-opt-name">Sans prise de t√™te</div><div class="pv-opt-desc">On verra ce que le destin nous r√©serve</div></div>
        </div>
        <div class="pv-option" id="pv-opt-ouverte">
          <div class="pv-checkbox" id="pv-check-ouverte"></div>
          <div><div class="pv-opt-name">Ouverte</div><div class="pv-opt-desc">C'est que pour faire du cardio</div></div>
        </div>
        <div class="pv-option" id="pv-opt-amical">
          <div class="pv-checkbox" id="pv-check-amical"></div>
          <div><div class="pv-opt-name">Amical</div><div class="pv-opt-desc">T'es le Sang</div></div>
        </div>
        <div class="pv-option" id="pv-opt-amicalpp">
          <div class="pv-checkbox" id="pv-check-amicalpp"></div>
          <div><div class="pv-opt-name">Amical++</div><div class="pv-opt-desc">L'amiti√©... mais avec des avantages n√©gociables</div></div>
        </div>
      </div>
    </div>

    <!-- Note -->
    <div class="pv-section">
      <div class="pv-label">Note personnelle</div>
      <div class="pv-note-box">
        <div class="pv-note-text" id="pv-message-display"></div>
      </div>
    </div>

    <!-- Legal -->
    <div class="pv-section">
      <p class="pv-legal">Les parties reconnaissent que, suite √† la clarification de leurs attentes et √† la s√©lection d'un type de relation, il est possible que l'interaction ou la communication entre elles √©volue ou prenne fin. Cette d√©cision devra √™tre prise dans un esprit de respect mutuel, sans obligation dans le maintien d'une relation au-del√† de ce qui est souhait√© par l'une ou l'autre des parties.</p>
    </div>

    <hr class="pv-hr bottom">

    <!-- Signature -->
    <div class="pv-sig-block">
      <div class="pv-sig-area">
        <div class="pv-sig-line"></div>
        <div class="pv-sig-label">SIGNATURE</div>
      </div>
    </div>

    <!-- Date footer -->
    <div class="pv-date">
      <span class="pv-date-text" id="pv-date-display"></span>
      <span class="pv-date-text" style="letter-spacing:1px; font-style:normal;">‚ú¶</span>
    </div>
  </div>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script>
  // ‚îÄ‚îÄ‚îÄ CONFIGURATION ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  const GAS_URL = "https://script.google.com/macros/s/AKfycbxCVQhoouL1dFsCrA44CCxwu0Td-iiR2XhwlXVzV_TzPWttnTfBGZsQsu1DUDrQPTo/exec";
  // ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ

  let lastSubmission = {};

  // ‚îÄ‚îÄ Radio visual update ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  document.querySelectorAll('input[type="radio"]').forEach(radio => {
    radio.addEventListener('change', function() {
      document.querySelectorAll('.option-item').forEach(el => el.classList.remove('selected'));
      if (this.checked) this.closest('.option-item').classList.add('selected');
    });
  });

  // ‚îÄ‚îÄ Submit ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  function submitContract() {
    var name   = document.getElementById('name').value.trim();
    var typeEl = document.querySelector('input[name="type"]:checked');
    var errorEl = document.getElementById('error-msg');

    if (!name || !typeEl) {
      errorEl.style.display = 'block';
      errorEl.textContent = 'Veuillez remplir votre pr√©nom et choisir un type de relation.';
      return;
    }
    errorEl.style.display = 'none';

    var type    = typeEl.value;
    var message = document.getElementById('message').value.trim();
    var now     = new Date();
    var dateStr = now.toLocaleDateString('fr-FR', { day: '2-digit', month: 'long', year: 'numeric' });
    var pad = function(n) { return String(n).padStart(2,'0'); };
    var dateSig = pad(now.getDate()) + '-' + pad(now.getMonth()+1) + '-' + now.getFullYear();

    lastSubmission = { name, type, message, date: dateStr, dateSig };

    var btn = document.querySelector('.submit-btn');
    btn.textContent = '‚ú¶  G√©n√©ration du contrat...  ‚ú¶';
    btn.disabled = true;

    // Generate PDF first, then send everything (data + pdf) to GAS
    generatePDFBase64(name, type, message, dateSig).then(function(pdfBase64) {
      var payload = {
        name    : name,
        type    : type,
        message : message || '(aucune note)',
        date    : dateStr,
        pdfBase64: pdfBase64   // PDF ready-made from the browser
      };

      btn.textContent = '‚ú¶  Envoi en cours...  ‚ú¶';

      return fetch(GAS_URL, {
        method : 'POST',
        headers: { 'Content-Type': 'text/plain;charset=utf-8' },
        body   : JSON.stringify(payload)
      });
    })
    .then(function(res) { return res.json().catch(function(){ return {}; }); })
    .then(function() { showSuccess(); })
    .catch(function(err) {
      console.warn('GAS fetch error:', err);
      fallbackMailto(name, type, message, dateStr);
    })
    .finally(function() {
      btn.disabled = false;
      btn.textContent = '‚ú¶   Signer & Envoyer   ‚ú¶';
    });
  }

  function showSuccess() {
    document.getElementById('success-overlay').classList.add('show');
  }

  function fallbackMailto(name, type, message, dateStr) {
    var subject = encodeURIComponent('Contrat signe par ' + name + ' - ' + type);
    var body = encodeURIComponent('CONTRAT - Mise au point sur notre relation\n\nSignataire : ' + name + '\nDate : ' + dateStr + '\nType choisi : ' + type + '\n\nNote personnelle :\n' + (message || '(aucune)'));
    window.open('mailto:?subject=' + subject + '&body=' + body);
    showSuccess();
  }

  async function downloadPDF() {
    var { name, type, message, dateSig } = lastSubmission;

    document.getElementById('success-overlay').classList.remove('show');

    var loadingEl = document.createElement('div');
    loadingEl.id = 'pdf-loading';
    loadingEl.style.cssText = 'position:fixed;inset:0;background:rgba(26,20,16,0.85);z-index:200;display:flex;flex-direction:column;align-items:center;justify-content:center;';
    loadingEl.innerHTML = '<div style="font-family:Cinzel,serif;color:#f5f0e8;font-size:13px;letter-spacing:4px;margin-bottom:14px;">G√âN√âRATION DU PDF...</div><div style="width:36px;height:36px;border:2px solid rgba(184,151,42,0.3);border-top-color:#b8972a;border-radius:50%;animation:spin 0.8s linear infinite;"></div>';
    document.body.appendChild(loadingEl);

    try {
      var pdfBase64 = await generatePDFBase64(name, type, message, dateSig);

      // Convert base64 to blob and trigger download
      var binary = atob(pdfBase64);
      var bytes  = new Uint8Array(binary.length);
      for (var i = 0; i < binary.length; i++) bytes[i] = binary.charCodeAt(i);
      var blob = new Blob([bytes], { type: 'application/pdf' });
      var url  = URL.createObjectURL(blob);
      var a    = document.createElement('a');
      a.href     = url;
      a.download = 'Contrat_' + (name || 'relation').replace(/\s+/g,'_') + '.pdf';
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
      URL.revokeObjectURL(url);

    } catch(err) {
      console.error('PDF download error:', err);
      alert('Erreur lors de la g√©n√©ration du PDF.');
    } finally {
      document.body.removeChild(loadingEl);
    }
  }

  // Core PDF generation ‚Äî returns a base64 string
  async function generatePDFBase64(name, type, message, dateSig) {
    var container = document.createElement('div');
    container.style.cssText = 'position:fixed;left:-9999px;top:0;width:794px;background:#f5f0e8;box-sizing:border-box;';
    container.innerHTML = buildPDFContainerHTML(name, type, message, dateSig);
    document.body.appendChild(container);

    await document.fonts.ready;
    await new Promise(function(r){ setTimeout(r, 180); });

    var canvas = await html2canvas(container, {
      scale: 2.5,
      useCORS: true,
      allowTaint: true,
      backgroundColor: '#f5f0e8',
      width: 794,
      scrollX: 0,
      scrollY: 0,
      windowWidth: 794
    });

    document.body.removeChild(container);

    var { jsPDF } = window.jspdf;
    var pdf   = new jsPDF({ orientation: 'portrait', unit: 'mm', format: 'a4' });
    var imgW  = canvas.width;
    var imgH  = canvas.height;
    var pageW = 210;
    var pageH = 297;
    var scale = pageW / (imgW / 2.5);
    var renderedH = (imgH / 2.5) * scale;
    var imgData = canvas.toDataURL('image/jpeg', 0.97);

    if (renderedH <= pageH) {
      pdf.addImage(imgData, 'JPEG', 0, 0, pageW, renderedH);
    } else {
      var sliceH_px = Math.floor((pageH / renderedH) * imgH);
      var offsetY   = 0;
      var page      = 0;
      while (offsetY < imgH) {
        if (page > 0) pdf.addPage();
        var sc = document.createElement('canvas');
        sc.width  = imgW;
        sc.height = Math.min(sliceH_px, imgH - offsetY);
        sc.getContext('2d').drawImage(canvas, 0, offsetY, imgW, sc.height, 0, 0, imgW, sc.height);
        var sh = (sc.height / imgH) * renderedH;
        pdf.addImage(sc.toDataURL('image/jpeg', 0.97), 'JPEG', 0, 0, pageW, sh);
        offsetY += sliceH_px;
        page++;
      }
    }

    // Return raw base64 (no data-url prefix)
    return pdf.output('datauristring').split(',')[1];
  }

  function buildPDFContainerHTML(name, type, message, dateSig) {
    var gold   = '#b8972a';
    var red    = '#8b1a1a';
    var ink    = '#1a1410';
    var inkL   = '#3d3028';
    var border = '#c8b89a';
    var paper  = '#f5f0e8';

    var descMap = {
      'S√©rieuse':           "Fid√®le jusqu'√† la mort m√™me au-del√†",
      'Sans prise de t√™te': "On verra ce que le destin nous r√©serve",
      'Ouverte':                 "C'est que pour faire du cardio",
      'Amical':                  "T'es le Sang",
      'Amical++':                "L'amiti√©... mais avec des avantages n√©gociables"
    };
    var selectedDesc = descMap[type] || '';

    var labelStyle =
      'font-family:Cinzel,serif;font-size:13px;font-weight:600;letter-spacing:3px;' +
      'color:' + gold + ';text-transform:uppercase;margin-bottom:8px;padding-bottom:5px;' +
      'border-bottom:1px solid ' + border + ';display:block;';

    var sectionStyle = 'margin-bottom:26px;';

    var noteText = (message && message !== '(aucune note)')
      ? '<span style="font-size:17px;color:' + inkL + ';line-height:1.8;font-style:italic;">' + message.replace(/\n/g,'<br>') + '</span>'
      : '<span style="font-size:17px;color:#b8a898;font-style:italic;">Aucune note</span>';

    var hrGold =
      '<div style="height:2px;background:linear-gradient(90deg,transparent,' + gold + ',' + border + ',' + gold + ',transparent);' +
      'opacity:0.65;margin:0 -20px 26px;"></div>';
    var hrBottom =
      '<div style="height:2px;background:linear-gradient(90deg,transparent,' + gold + ',' + border + ',' + gold + ',transparent);' +
      'opacity:0.65;margin:0 -20px 24px;"></div>';

    var corners =
      '<div style="position:absolute;top:16px;left:16px;color:' + gold + ';font-size:10px;opacity:0.5;">‚ú¶</div>' +
      '<div style="position:absolute;top:16px;right:16px;color:' + gold + ';font-size:10px;opacity:0.5;">‚ú¶</div>' +
      '<div style="position:absolute;bottom:16px;left:16px;color:' + gold + ';font-size:10px;opacity:0.5;">‚ú¶</div>' +
      '<div style="position:absolute;bottom:16px;right:16px;color:' + gold + ';font-size:10px;opacity:0.5;">‚ú¶</div>';

    var seal =
      '<div style="width:52px;height:52px;border-radius:50%;' +
      'background:radial-gradient(circle at 40% 35%,#c0392b,#7b1a1a);' +
      'margin:0 auto;display:flex;align-items:center;justify-content:center;' +
      'font-size:18px;color:rgba(255,255,255,0.65);box-shadow:0 4px 16px rgba(139,26,26,0.4);">‚ùß</div>';

    return (
      '<div style="position:relative;background:' + paper + ';padding:56px 64px 52px;' +
      'min-height:1100px;box-sizing:border-box;border:1px solid ' + border + ';">' +
        corners + seal +
        '<div style="height:24px;"></div>' +
        hrGold +

        '<h1 style="font-family:Cinzel,serif;font-size:26px;font-weight:600;letter-spacing:8px;' +
        'text-align:center;color:' + ink + ';margin:0 0 6px;">CONTRAT</h1>' +
        '<p style="font-family:Cormorant Garamond,Georgia,serif;font-style:italic;font-size:17px;' +
        'text-align:center;color:' + inkL + ';letter-spacing:1px;margin:0 0 32px;">' +
        'Mise au point sur notre relation</p>' +

        '<div style="' + sectionStyle + '">' +
          '<span style="' + labelStyle + '">Objectif</span>' +
          '<p style="font-size:17px;line-height:1.8;color:' + inkL + ';font-style:italic;margin:0;">' +
          'Je souhaite clarifier notre relation pour pr√©venir tout malentendu ou conflit potentiel.</p>' +
        '</div>' +

        '<div style="' + sectionStyle + '">' +
          '<span style="' + labelStyle + '">Identit√©</span>' +
          '<p style="font-size:17px;line-height:1.8;color:' + inkL + ';font-style:italic;margin:0;">' +
            'Je soussign√©(e)¬†' +
            '<span style="font-style:normal;color:' + ink + ';font-weight:600;">' + name + '</span>' +
            ',¬†souhaite pr√©ciser que je suis en faveur d‚Äôune relation de type¬†:' +
          '</p>' +
        '</div>' +

        '<div style="' + sectionStyle + '">' +
          '<span style="' + labelStyle + '">Nature de la relation</span>' +
          '<div style="text-align:center;padding:8px 0 0;">' +
            '<div style="font-family:Cormorant Garamond,Georgia,serif;font-size:26px;font-weight:700;' +
            'color:' + red + ';letter-spacing:0.5px;line-height:1.2;margin-bottom:8px;">' + type + '</div>' +
            '<div style="font-size:15px;color:#7a6a5a;font-style:italic;">' + selectedDesc + '</div>' +
          '</div>' +
        '</div>' +

        '<div style="' + sectionStyle + '">' +
          '<span style="' + labelStyle + '">Note personnelle</span>' +
          '<div style="padding:2px 0 0 2px;">' + noteText + '</div>' +
        '</div>' +

        '<div style="border-top:1px solid ' + border + ';padding-top:14px;margin-bottom:26px;">' +
          '<p style="font-size:15px;line-height:1.7;color:#8a7a6a;font-style:italic;margin:0;">' +
            'Les parties reconnaissent que, suite √† la clarification de leurs attentes et √† la s√©lection d‚Äôun ' +
            'type de relation, il est possible que l‚Äôinteraction ou la communication entre elles √©volue ou prenne fin. ' +
            'Cette d√©cision devra √™tre prise dans un esprit de respect mutuel, sans obligation dans le maintien ' +
            'd‚Äôune relation au-del√† de ce qui est souhait√© par l‚Äôune ou l‚Äôautre des parties.' +
          '</p>' +
        '</div>' +

        hrBottom +

        '<div style="text-align:right;">' +
          '<div style="display:inline-block;text-align:center;min-width:200px;">' +
            '<div style="border-top:1.5px solid ' + ink + ';padding-top:8px;">' +
              '<div style="font-family:Cinzel,serif;font-size:9px;letter-spacing:2px;' +
              'color:#7a6a5a;margin-bottom:6px;text-transform:uppercase;">Signature √âlectronique</div>' +
              '<div style="font-family:Cormorant Garamond,Georgia,serif;font-style:italic;' +
              'font-size:17px;color:' + inkL + ';line-height:1.6;">' +
                'Sign√© par <strong style="font-style:normal;color:' + ink + ';">' + name + '</strong><br>' +
                '<span style="font-size:13px;color:#7a6a5a;">le¬†' + dateSig + '</span>' +
              '</div>' +
            '</div>' +
          '</div>' +
        '</div>' +

      '</div>'
    );
  }
  function closeSuccess() {
    document.getElementById('success-overlay').classList.remove('show');
    document.getElementById('name').value = '';
    document.getElementById('message').value = '';
    document.querySelectorAll('input[type="radio"]').forEach(r => r.checked = false);
    document.querySelectorAll('.option-item').forEach(el => el.classList.remove('selected'));
    lastSubmission = {};
  }
</script>
</body>
